<!DOCTYPE html>
<html>
<head>
    <title>Angebote und Suchanfragen - MyCargonaut</title>
    <link rel="stylesheet" type="text/css" href="css/dashboard.css">
</head>
<body class="dashboard">
    <header>
        <nav>
            <ul>
                <li><a href="dashboard.html">Startseite</a></li>
                <li><a href="profile.html">Profil</a></li>
                <li><a href="vehicles.html">Fahrzeugverwaltung</a></li>
                <li><a href="offers.html">Angebote</a></li>
                <li><a href="search.html">Suchanfragen</a></li>
                <li><a href="myrides.html">Meine Fahrten</a></li>
                <li><a href="support.html">Support</a></li>
                <li><a href="logout.html">Abmelden</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="search-requests">
            <h2>Suchanfragen</h2>
            <!-- Liste der aktuellen Suchanfragen -->
            <ul id="searchList">
                <!-- Hier werden Suchanfragen dynamisch eingefügt -->
            </ul>
        </section>
        <section id="create-search">
            <h2>Neue Suchanfrage erstellen</h2>
            <form id="searchForm">
                <input type="text" id="startOrt" name="startOrt" placeholder="Startort" required>
                <input type="text" id="zielOrt" name="zielOrt" placeholder="Zielort" required>
                <input type="date" id="startDatum" name="startDatum" required>
                <input type="number" id="personen" name="personen" placeholder="Personenanzahl" required>
                <input type="number" id="raum" name="raum" placeholder="Benötigter Raum" required>
                <input type="number" id="gewicht" name="gewicht" placeholder="Gewicht" required>
                <button type="submit">Suchanfrage erstellen</button>
            </form>
        </section>


    </main>

    <script>
        // Skript zum Senden von Suchanfragen und Laden aller vorhandenen Suchanfragen

        // Funktion zum Laden der Suchanfragen
        function loadSearchRequests() {
            fetch('/getSearchRequests')
                .then(response => response.json())
                .then(searchRequests => {
                    const searchList = document.getElementById('searchList');
                    searchList.innerHTML = ''; // Liste zuerst leeren
                    searchRequests.forEach(request => {
                        searchList.innerHTML +=
                            `<li>${request.benutzername} sucht Fahrt von ${request.startOrt} nach ${request.zielOrt} am ${request.startDatum} -
                Personen: ${request.personen}, Raum: ${request.raum}, Gewicht: ${request.gewicht}</li>`;
                    });
                })
                .catch(error => console.error('Fehler beim Laden der Suchanfragen:', error));
        }

        // Event-Listener für das Suchformular
        document.getElementById('searchForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const formData = new FormData(this);
            const formBody = new URLSearchParams(formData).toString();

            fetch('/addSearch', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: formBody
            })
                .then(response => {
                    if (response.ok) {
                        alert('Suchanfrage erfolgreich erstellt');
                        loadSearchRequests(); // Lädt die Suchanfragen neu, um die Liste zu aktualisieren
                    } else {
                        throw new Error('Fehler beim Erstellen der Suchanfrage');
                    }
                })
                .catch(error => {
                    console.error('Fehler:', error);
                });
        });

        // Laden der Suchanfragen beim ersten Seitenaufruf
        loadSearchRequests();
    </script>


    <footer>
        <p>© 2023 MyCargonaut</p>
    </footer>
</body>
</html>
